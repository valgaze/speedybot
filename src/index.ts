/**
 â•±â•­â”â”â”â•®â•±â•­â”â”â”â•®â•±â•­â”â”â”â•®â•±â•­â”â”â”â•®â•±â•­â”â”â”â•®â•±â•­â•®â•±â•±â•­â•®â•±â•­â”â”â•®â•±â•±â•­â”â”â”â•®â•±â•­â”â”â”â”â•®â•±
â•±â”ƒâ•­â”â•®â”ƒâ•±â”ƒâ•­â”â•®â”ƒâ•±â”ƒâ•­â”â”â•¯â•±â”ƒâ•­â”â”â•¯â•±â•°â•®â•­â•®â”ƒâ•±â”ƒâ•°â•®â•­â•¯â”ƒâ•±â”ƒâ•­â•®â”ƒâ•±â•±â”ƒâ•­â”â•®â”ƒâ•±â”ƒâ•­â•®â•­â•®â”ƒâ•±
â•±â”ƒâ•°â”â”â•®â•±â”ƒâ•°â”â•¯â”ƒâ•±â”ƒâ•°â”â”â•®â•±â”ƒâ•°â”â”â•®â•±â•±â”ƒâ”ƒâ”ƒâ”ƒâ•±â•°â•®â•°â•¯â•­â•¯â•±â”ƒâ•°â•¯â•°â•®â•±â”ƒâ”ƒâ•±â”ƒâ”ƒâ•±â•°â•¯â”ƒâ”ƒâ•°â•¯â•±
â•±â•°â”â”â•®â”ƒâ•±â”ƒâ•­â”â”â•¯â•±â”ƒâ•­â”â”â•¯â•±â”ƒâ•­â”â”â•¯â•±â•±â”ƒâ”ƒâ”ƒâ”ƒâ•±â•±â•°â•®â•­â•¯â•±â•±â”ƒâ•­â”â•®â”ƒâ•±â”ƒâ”ƒâ•±â”ƒâ”ƒâ•±â•±â•±â”ƒâ”ƒâ•±â•±â•±
â•±â”ƒâ•°â”â•¯â”ƒâ•±â”ƒâ”ƒâ•±â•±â•±â•±â”ƒâ•°â”â”â•®â•±â”ƒâ•°â”â”â•®â•±â•­â•¯â•°â•¯â”ƒâ•±â•±â•±â”ƒâ”ƒâ•±â•±â•±â”ƒâ•°â”â•¯â”ƒâ•±â”ƒâ•°â”â•¯â”ƒâ•±â•±â•±â”ƒâ”ƒâ•±â•±â•±
â•±â•°â”â”â”â•¯â•±â•°â•¯â•±â•±â•±â•±â•°â”â”â”â•¯â•±â•°â”â”â”â•¯â•±â•°â”â”â”â•¯â•±â•±â•±â•°â•¯â•±â•±â•±â•°â”â”â”â•¯â•±â•°â”â”â”â•¯â•±â•±â•±â•°â•¯â•±â•±â•±
 */

export * from "./types";
export { SpeedyBot } from "./speedybot";
export { SpeedyCard } from "./cards";
export const CONSTANTS = {
  submitToken: "_private_speedybot_",
  CHIP_LABEL: "speedybot_CHIP_CLICK",
  invalidMessage: "Invalid message passed to sendTo",
  unwrapLabel: "ğŸ Unwrap",
  destroyLabel: "ğŸ”¥ Destroy",
  action_delete: "delete",
};
export type { SurveyQuestion, SurveyQuestionType } from "./cards";

export const botTokenKey = "BOT_TOKEN";
export const botPlaceholder = "__REPLACE__ME__";

import { RequestOps } from "./types";

// Workhorse makeRequest w/ fetch, can be stubbed for testing

class RequestError extends Error {
  statusCode: number;
  url: string;

  constructor(message: string, statusCode: number, url: string) {
    super(message);
    this.statusCode = statusCode;
    this.url = url;

    if (Error.captureStackTrace) {
      Error.captureStackTrace(this, RequestError);
    }
  }
}

export const mainRequester = async (
  url: string,
  body: any,
  opts: RequestOps = {}
) => {
  // escape hatch to pass init directly to fetch
  if ("rawInit" in opts) {
    try {
      const response = await fetch(url, opts.rawInit);
      if (!response.ok) {
        throw new RequestError(
          `The request to ${url} failed with status ${response.status}${
            response.status === 401
              ? " (You may need to double-check your access token)"
              : ""
          }`,
          response.status,
          url
        );
      }
      return response;
    } catch (error) {
      throw error; // Re-throw custom error or new/exciting error
    }
  }

  const defaultConfig = {
    method: "POST",
    "content-type": "application/json;charset=UTF-8",
    raw: false,
  };

  const contentType = opts["content-type"] || defaultConfig["content-type"];
  const init: {
    method: string;
    headers: any;
    body?: any;
    [key: string]: any;
  } = {
    method: opts.method ? opts.method : defaultConfig.method,
    headers: {
      "content-type": contentType,
      Authorization: `Bearer ${opts.token}`,
      ...(opts.headers || {}),
    },
  };
  if (
    opts.method === "POST" ||
    opts.method === "PUT" ||
    opts.method === "PATCH"
  ) {
    init.body = opts.raw ? body : JSON.stringify(body);
  }
  try {
    const response = await fetch(url, init);
    if (!response.ok) {
      throw new RequestError(
        `The request to ${url} failed with status ${response.status}${
          response.status === 401
            ? " (You may need to double-check your access token)"
            : ""
        }`,
        response.status,
        url
      );
    }
    return response;
  } catch (error) {
    throw error;
  }
};

export const logoRoll = (idx?: number) => {
  const variants = [
    `
  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
  â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â•šâ•â•â–ˆâ–ˆâ•”â•â•â•
  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   
  â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘  â•šâ–ˆâ–ˆâ•”â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   
  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•   â–ˆâ–ˆâ•‘   
  â•šâ•â•â•â•â•â•â•â•šâ•â•     â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•    â•šâ•â•   â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â•    â•šâ•â•
  https://speedybot.js.org`,
    `
  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
  â–‘â–‘â–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆâ–ˆâ–‘â–‘â–ˆâ–‘â–ˆâ–‘â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–ˆâ–‘
  â–‘â–ˆ   â–‘â–ˆ  â–ˆâ–‘â–ˆ   â–‘â–ˆ   â–‘â–ˆ  â–ˆâ–‘â–ˆâ–ˆâ–ˆâ–‘â–ˆ  â–ˆâ–‘â–ˆ  â–ˆâ–‘ â–ˆ â–‘
  â–‘ â–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–ˆ â–‘â–ˆâ–ˆâ–ˆâ–‘â–‘â–ˆâ–ˆâ–ˆâ–‘â–‘â–ˆâ–‘â–‘â–ˆâ–‘ â–ˆ â–‘â–ˆâ–ˆâ–ˆ â–‘â–ˆâ–‘â–‘â–ˆâ–‘â–‘â–ˆâ–‘â–‘
  â–‘â–‘  â–ˆâ–‘â–ˆ  â–‘â–‘â–ˆ  â–‘â–‘â–ˆ  â–‘â–‘â–ˆâ–‘â–‘â–ˆâ–‘â–‘â–ˆâ–‘â–‘â–ˆ  â–ˆâ–‘â–ˆâ–‘â–‘â–ˆâ–‘â–‘â–ˆâ–‘â–‘
  â–‘â–ˆâ–ˆâ–ˆ â–‘â–ˆâ–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–ˆâ–ˆâ–ˆ â–‘â–‘â–ˆâ–‘â–‘â–ˆâ–ˆâ–ˆ â–‘ â–ˆâ–ˆ â–‘â–‘â–ˆâ–‘â–‘
  â–‘   â–‘â–‘ â–‘â–‘â–‘â–‘    â–‘    â–‘   â–‘â–‘â–‘ â–‘â–‘   â–‘â–‘â–‘  â–‘â–‘â–‘ â–‘â–‘
  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
  https://speedybot.js.org`,
    `
  â•±â•­â”â”â”â•®â•±â•­â”â”â”â•®â•±â•­â”â”â”â•®â•±â•­â”â”â”â•®â•±â•­â”â”â”â•®â•±â•­â•®â•±â•±â•­â•®â•±â•­â”â”â•®â•±â•±â•­â”â”â”â•®â•±â•­â”â”â”â”â•®â•±
  â•±â”ƒâ•­â”â•®â”ƒâ•±â”ƒâ•­â”â•®â”ƒâ•±â”ƒâ•­â”â”â•¯â•±â”ƒâ•­â”â”â•¯â•±â•°â•®â•­â•®â”ƒâ•±â”ƒâ•°â•®â•­â•¯â”ƒâ•±â”ƒâ•­â•®â”ƒâ•±â•±â”ƒâ•­â”â•®â”ƒâ•±â”ƒâ•­â•®â•­â•®â”ƒâ•±
  â•±â”ƒâ•°â”â”â•®â•±â”ƒâ•°â”â•¯â”ƒâ•±â”ƒâ•°â”â”â•®â•±â”ƒâ•°â”â”â•®â•±â•±â”ƒâ”ƒâ”ƒâ”ƒâ•±â•°â•®â•°â•¯â•­â•¯â•±â”ƒâ•°â•¯â•°â•®â•±â”ƒâ”ƒâ•±â”ƒâ”ƒâ•±â•°â•¯â”ƒâ”ƒâ•°â•¯â•±
  â•±â•°â”â”â•®â”ƒâ•±â”ƒâ•­â”â”â•¯â•±â”ƒâ•­â”â”â•¯â•±â”ƒâ•­â”â”â•¯â•±â•±â”ƒâ”ƒâ”ƒâ”ƒâ•±â•±â•°â•®â•­â•¯â•±â•±â”ƒâ•­â”â•®â”ƒâ•±â”ƒâ”ƒâ•±â”ƒâ”ƒâ•±â•±â•±â”ƒâ”ƒâ•±â•±â•±
  â•±â”ƒâ•°â”â•¯â”ƒâ•±â”ƒâ”ƒâ•±â•±â•±â•±â”ƒâ•°â”â”â•®â•±â”ƒâ•°â”â”â•®â•±â•­â•¯â•°â•¯â”ƒâ•±â•±â•±â”ƒâ”ƒâ•±â•±â•±â”ƒâ•°â”â•¯â”ƒâ•±â”ƒâ•°â”â•¯â”ƒâ•±â•±â•±â”ƒâ”ƒâ•±â•±â•±
  â•±â•°â”â”â”â•¯â•±â•°â•¯â•±â•±â•±â•±â•°â”â”â”â•¯â•±â•°â”â”â”â•¯â•±â•°â”â”â”â•¯â•±â•±â•±â•°â•¯â•±â•±â•±â•°â”â”â”â•¯â•±â•°â”â”â”â•¯â•±â•±â•±    â•±`,
    `
  â”€â•”â•â•â•â•—â”€â•”â•â•â•â•—â”€â•”â•â•â•â•—â”€â•”â•â•â•â•—â”€â•”â•â•â•â•—â”€â•”â•—â”€â”€â•”â•—â”€â•”â•â•â•—â”€â”€â•”â•â•â•â•—â”€â•”â•â•â•â•â•—â”€
  â”€â•‘â•”â•â•—â•‘â”€â•‘â•”â•â•—â•‘â”€â•‘â•”â•â•â•â”€â•‘â•”â•â•â•â”€â•šâ•—â•”â•—â•‘â”€â•‘â•šâ•—â•”â•â•‘â”€â•‘â•”â•—â•‘â”€â”€â•‘â•”â•â•—â•‘â”€â•‘â•”â•—â•”â•—â•‘â”€
  â”€â•‘â•šâ•â•â•—â”€â•‘â•šâ•â•â•‘â”€â•‘â•šâ•â•â•—â”€â•‘â•šâ•â•â•—â”€â”€â•‘â•‘â•‘â•‘â”€â•šâ•—â•šâ•â•”â•â”€â•‘â•šâ•â•šâ•—â”€â•‘â•‘â”€â•‘â•‘â”€â•šâ•â•‘â•‘â•šâ•â”€
  â”€â•šâ•â•â•—â•‘â”€â•‘â•”â•â•â•â”€â•‘â•”â•â•â•â”€â•‘â•”â•â•â•â”€â”€â•‘â•‘â•‘â•‘â”€â”€â•šâ•—â•”â•â”€â”€â•‘â•”â•â•—â•‘â”€â•‘â•‘â”€â•‘â•‘â”€â”€â”€â•‘â•‘â”€â”€â”€
  â”€â•‘â•šâ•â•â•‘â”€â•‘â•‘â”€â”€â”€â”€â•‘â•šâ•â•â•—â”€â•‘â•šâ•â•â•—â”€â•”â•â•šâ•â•‘â”€â”€â”€â•‘â•‘â”€â”€â”€â•‘â•šâ•â•â•‘â”€â•‘â•šâ•â•â•‘â”€â”€â”€â•‘â•‘â”€â”€â”€
  â”€â•šâ•â•â•â•â”€â•šâ•â”€â”€â”€â”€â•šâ•â•â•â•â”€â•šâ•â•â•â•â”€â•šâ•â•â•â•â”€â”€â”€â•šâ•â”€â”€â”€â•šâ•â•â•â•â”€â•šâ•â•â•â•â”€â”€â”€â•šâ•â”€â”€â”€`,
    `
  â•”â•â•— â•”â•â•— â•”â•â•— â•”â•â•— â•”â•¦â•— â•¦ â•¦ â•”â•—  â•”â•â•— â•”â•¦â•— 
  â•šâ•â•— â• â•â• â•‘â•£  â•‘â•£   â•‘â•‘ â•šâ•¦â• â• â•©â•— â•‘ â•‘  â•‘  
  â•šâ•â• â•©   â•šâ•â• â•šâ•â• â•â•©â•  â•©  â•šâ•â• â•šâ•â•  â•© `,
  ];

  if (idx) {
    const logo =
      variants[idx] || variants[Math.floor(Math.random() * variants.length)];
    return logo;
  }
  const logo = variants[Math.floor(Math.random() * variants.length)];
  return logo;
};
